---
title: Federated schema checks
---

> For an introduction to schema checks, see [Schema checks](https://www.apollographql.com/docs/studio/schema-checks/).

Federation enables teams to work independently on subgraphs without needing to coordinate on a monolithic schema. However, this increase in autonomy requires controls to ensure that teams respect [defined dependencies](../federation-spec/) ensure that supergraph composition succeeds.

In particular, along with validating overall schema changes against known operations, running `rover subgraph check` for a subgraph helps ensure that all subgraph schemas still compose to a valid supergraph schema, and will output any violated dependencies if present.

When you run `rover subgraph check` on a particular subgraph, Apollo Studio runs composition on the proposed capabilities with the current list of subgraphs and their capabilities, making sure that the composition is successful. That composed schema is then compared against the most recently registered schema to confirm that those changes are safe. If composition fails, then validation ends and results are returned to the user. Note that running `rover subgraph check` never updates the graph.

There are two types of failures that can occur during validation: failed usage checks and failed composition. Failed usage checks are failures due to breaking changes, like removing a field that an active client is querying. Failed composition, on the other hand, is a failure due to inability to compose the graph, like missing a `@key` for an extended entity.

## Handling composition failure

In general, you should run `rover subgraph publish` only after a successful run of `rover subgraph check`. Even in this case, however, it's possible that `rover subgraph publish` will encounter composition errors because of simultaneous changes to _another_ subgraph. When this happens, your subgraph's registered schema will still be updated as long as its capabilities are spec-compliant, but **the graph will not be updated**. This means that a new schema will not be associated, nor will the gateway's configuration be updated.

An example output of this behavior looks like this:

```
$ rover subgraph publish docs-example-graph@current --name books --schema ./schema.graphql

Publishing SDL to docs-example-graph:current (subgraph: books) using credentials from the default profile.
The gateway for the 'docs-example-graph' graph was NOT updated with a new schema
WARN: The following composition errors occurred: 
Field "Author.name" can only be defined once.
There can be only one type named "Author".
Field "Book.title" can only be defined once.
Field "Book.author" can only be defined once.
There can be only one type named "Book".
```

The reasoning behind this functionality is that the Apollo schema registry should always reflect what is running in your infrastructure. Even if that means that composition is failing in your infrastructure, the registry should reflect that. However, you still want your gateway to function as it was before the most recent deployment. Additionally, this functionality can be used to make dependent changes, like smoothly migrating a field from one subgraph to another or introducing a circular dependency.
